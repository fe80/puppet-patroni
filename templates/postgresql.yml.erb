scope: <%= scope.lookupvar('patroni::scope') %>
namespace: <%= scope.lookupvar('patroni::namespace') %>
name: <%= scope.lookupvar('patroni::hostname') %>

bootstrap:
  dcs:
    ttl: <%= scope.lookupvar('patroni::dcs_ttl') %>
    loop_wait: <%= scope.lookupvar('patroni::dcs_loop_wait') %>
    retry_timeout: <%= scope.lookupvar('patroni::dcs_retry_timeout') %>
    maximum_lag_on_failover: <%= scope.lookupvar('patroni::dcs_maximum_lag_on_failover') %>
    master_start_timeout: <%= scope.lookupvar('patroni::dcs_master_start_timeout') %>
    synchronous_mode: <%= scope.lookupvar('patroni::dcs_synchronous_mode') %>
    synchronous_mode_strict: <%= scope.lookupvar('patroni::dcs_synchronous_mode_strict') %>
    postgresql:
      use_pg_rewind: <%= scope.lookupvar('patroni::dcs_postgresql_use_pg_rewind') ? 'true' : 'false' %>
      use_slots: <%= scope.lookupvar('patroni::dcs_postgresql_use_slots') ? 'true' : 'false' %>
<% unless @dcs_postgresql_recovery_conf.empty? -%>
      recovery_conf:
<% @dcs_postgresql_recovery_conf.each do |name,val| -%>
        <%= name -%>: <%= val %>
<% end -%>
<% end -%>
<% unless @dcs_postgresql_parameters.empty? -%>
      parameters:
<% @dcs_postgresql_parameters.each do |name,val| -%>
        <%= name -%>: <%= val %>
<% end -%>
<% end -%>
  method: <%= scope.lookupvar('patroni::bootstrap_method') %>
  initdb:
<% if scope.lookupvar('patroni::initdb_data_checksums') -%>
    - data-checksums
<% end -%>
    - encoding: <%= scope.lookupvar('patroni::initdb_encoding') %>
    - locale: <%= scope.lookupvar('patroni::initdb_locale') %>
<% unless @bootstrap_pg_hba.empty? -%>
  pg_hba:
<% @bootstrap_pg_hba.each do |entry| -%>
    - <%= entry %>
<% end -%>
<% end -%>
<% unless @bootstrap_users.empty? -%>
  users:
<% @bootstrap_users.each do |name,settings| -%>
    <%= name -%>:
<% if settings['password'] -%>
      password: <%= settings['password'] %>
<% end -%>
<% if settings['options'] -%>
      options:
<% settings['options'].each do |option| -%>
        - <%= option %>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::bootstrap_post_bootstrap') != nil -%>
  post_bootstrap: <%= scope.lookupvar('patroni::bootstrap_post_bootstrap') %>
<% end -%>
<% if scope.lookupvar('patroni::bootstrap_post_init') != nil -%>
  post_init: <%= scope.lookupvar('patroni::bootstrap_post_init') %>
<% end -%>

postgresql:
  listen: <%= scope.lookupvar('patroni::pgsql_listen') %>
  connect_address: <%= scope.lookupvar('patroni::pgsql_connect_address') %>
  data_dir: <%= scope.lookupvar('patroni::pgsql_data_dir') %>
<% if scope.lookupvar('patroni::pgsql_bin_dir') -%>
  bin_dir: <%= scope.lookupvar('patroni::pgsql_bin_dir') %>
<% end -%>
<% if scope.lookupvar('patroni::pgsql_config_dir') != nil -%>
  config_dir: <%= scope.lookupvar('patroni::pgsql_config_dir') %>
<% end -%>
  use_unix_socket: <%= scope.lookupvar('patroni::pgsql_use_unix_socket') ? 'true' : 'false' %>
  pgpass: <%= scope.lookupvar('patroni::pgsql_pgpass_path') %>
  pg_ctl_timeout: <%= scope.lookupvar('patroni::pgsql_pg_ctl_timeout') %>
  use_pg_rewind: <%= scope.lookupvar('patroni::pgsql_use_pg_rewind') ? 'true' : 'false' %>
  remove_data_directory_on_rewind_failure: <%= scope.lookupvar('patroni::pgsql_remove_data_directory_on_rewind_failure') ? 'true' : 'false' %>
  authentication:
    superuser:
      username: <%= scope.lookupvar('patroni::superuser_username') %>
      password: <%= scope.lookupvar('patroni::superuser_password') %>
    replication:
      username: <%= scope.lookupvar('patroni::replication_username') %>
      password: <%= scope.lookupvar('patroni::replication_password') %>
<% unless scope.lookupvar('patroni::callback_on_reload') == nil && scope.lookupvar('patroni::callback_on_restart') == nil && scope.lookupvar('patroni::callback_on_role_change') == nil && scope.lookupvar('patroni::callback_on_start') == nil && scope.lookupvar('patroni::callback_on_stop') == nil -%>
  callbacks:
<% if scope.lookupvar('patroni::callback_on_reload') != nil -%>
    on_reload: <%= scope.lookupvar('patroni::callback_on_reload') %>
<% end -%>
<% if scope.lookupvar('patroni::callback_on_restart') != nil -%>
    on_restart: <%= scope.lookupvar('patroni::callback_on_restart') %>
<% end -%>
<% if scope.lookupvar('patroni::callback_on_role_change') != nil -%>
    on_role_change: <%= scope.lookupvar('patroni::callback_on_role_change') %>
<% end -%>
<% if scope.lookupvar('patroni::callback_on_start') != nil -%>
    on_start: <%= scope.lookupvar('patroni::callback_on_start') %>
<% end -%>
<% if scope.lookupvar('patroni::callback_on_stop') != nil -%>
    on_stop: <%= scope.lookupvar('patroni::callback_on_stop') %>
<% end -%>
<% end -%>
<% unless @pgsql_create_replica_methods.empty? -%>
  create_replica_methods:
<% @pgsql_create_replica_methods.each do |entry| -%>
    - <%= entry %>
<% end -%>
<% end -%>
<% unless @pgsql_pg_hba.empty? -%>
  pg_hba:
<% @pgsql_pg_hba.each do |entry| -%>
    - <%= entry %>
<% end -%>
<% end -%>
<% unless @pgsql_recovery_conf.empty? -%>
  recovery_conf:
<% @pgsql_recovery_conf.each do |name,val| -%>
    <%= name -%>: <%= val %>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::pgsql_custom_conf') != nil -%>
  custom_conf: <%= scope.lookupvar('patroni::pgsql_custom_conf') %>
<% end -%>
<% unless @pgsql_parameters_all.empty? -%>
  parameters:
<% @pgsql_parameters_all.each do |name,val| -%>
    <%= name -%>: <%= val %>
<% end -%>
<% end -%>
<% unless @pgsql_replica_method.empty? -%>
  replica_method:
<% @pgsql_replica_method.each do |name,settings| -%>
    <%= name -%>:
<% settings.each do |setname,setval| -%>
      <%= setname -%>: <%= setval %>
<% end -%>
<% end -%>
<% end -%>

restapi:
  listen: <%= scope.lookupvar('patroni::restapi_listen') %>
  connect_address: <%= scope.lookupvar('patroni::restapi_connect_address') %>
<% if scope.lookupvar('patroni::restapi_certfile') != nil -%>
  certfile: <%= scope.lookupvar('patroni::restapi_certfile') %>
<% end -%>
<% if scope.lookupvar('patroni::restapi_keyfile') != nil -%>
  keyfile: <%= scope.lookupvar('patroni::restapi_keyfile') %>
<% end -%>
<% if scope.lookupvar('patroni::restapi_cafile') != nil %>
  cafile: <%= scope.lookupvar('patroni::restapi_cafile') %>
<% end -%>
<% if scope.lookupvar('patroni::restapi_verify_client') != nil -%>
  verify_client: <%= scope.lookupvar('patroni::restapi_verify_client') %>
<% end -%>
<% if scope.lookupvar('patroni::restapi_username') != nil && scope.lookupvar('patroni::restapi_password') != nil -%>
  authentication:
    username: <%= scope.lookupvar('patroni::restapi_username') %>
    password: <%= scope.lookupvar('patroni::restapi_password') %>
<% end -%>

watchdog:
  mode: <%= scope.lookupvar('patroni::watchdog_mode') %>
  device: <%= scope.lookupvar('patroni::watchdog_device') %>
  safety_margin: <%= scope.lookupvar('patroni::watchdog_safety_margin') %>
<% if scope.lookupvar('patroni::use_etcd') -%>

etcd:
  host: <%= scope.lookupvar('patroni::etcd_host') %>
<% unless @etcd_hosts.empty? -%>
  hosts:
<% @etcd_hosts.each do |entry| -%>
    - <%= entry %>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::etcd_url') != nil -%>
  url: <%= scope.lookupvar('patroni::etcd_url') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_proxy') != nil -%>
  proxy: <%= scope.lookupvar('patroni::etcd_proxy') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_srv') != nil -%>
  srv: <%= scope.lookupvar('patroni::etcd_srv') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_protocol') != nil -%>
  protocol: <%= scope.lookupvar('patroni::etcd_protocol') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_username') != nil -%>
  username: <%= scope.lookupvar('patroni::etcd_username') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_password') != nil -%>
  password: <%= scope.lookupvar('patroni::etcd_password') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_cacert') != nil -%>
  cacert: <%= scope.lookupvar('patroni::etcd_cacert') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_cert') != nil -%>
  cert: <%= scope.lookupvar('patroni::etcd_cert') %>
<% end -%>
<% if scope.lookupvar('patroni::etcd_key') != nil -%>
  key: <%= scope.lookupvar('patroni::etcd_key') %>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::use_zookeeper') -%>

zookeeper:
  hosts: <%= @zookeeper_hosts.join(',') %>
<% end -%>
<% if scope.lookupvar('patroni::use_exhibitor') -%>

exhibitor:
  hosts:
<% @exhibitor_hosts.each do |entry| -%>
    - <%= entry %>
<% end -%>
  poll_interval: <%= scope.lookupvar('patroni::exhibitor_poll_interval') %>
  port: <%= scope.lookupvar('patroni::exhibitor_port') %>
<% end -%>
<% if scope.lookupvar('patroni::use_kubernetes') -%>

kubernetes:
  namespace: <%= scope.lookupvar('patroni::kubernetes_namespace') %>
  use_endpoints: <%= scope.lookupvar('patroni::kubernetes_use_endpoints') ? 'true' : 'false' %>
<% unless @kubernetes_labels.empty? -%>
  labels:
<% @kubernetes_labels.each do |name,val| -%>
    <%= name -%>: <%= val %>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::kubernetes_scope_label') != nil -%>
  scope_label: <%= scope.lookupvar('patroni::kubernetes_scope_label') %>
<% end -%>
<% if scope.lookupvar('patroni::kubernetes_role_label') != nil -%>
  role_label: <%= scope.lookupvar('patroni::kubernetes_role_label') %>
<% end -%>
<% if scope.lookupvar('patroni::kubernetes_pod_ip') != nil -%>
  pod_ip: <%= scope.lookupvar('patroni::kubernetes_pod_ip') %>
<% end -%>
<% if scope.lookupvar('patroni::kubernetes_ports') != nil -%>
  ports: <%= scope.lookupvar('patroni::kubernetes_ports') %>
<% end -%>
<% end -%>
<% if scope.lookupvar('patroni::use_consul') -%>

consul:
  host: <%= scope.lookupvar('patroni::consul_host') %>
  port: <%= scope.lookupvar('patroni::consul_port') %>
  scheme: <%= scope.lookupvar('patroni::consul_scheme') %>
  verify: <%= scope.lookupvar('patroni::consul_verify') ? 'true' : 'false' %>
<% if scope.lookupvar('patroni::consul_url') != nil -%>
  url: <%= scope.lookupvar('patroni::consul_url') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_token') != nil -%>
  token: <%= scope.lookupvar('patroni::consul_token') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_cacert') != nil -%>
  cacert: <%= scope.lookupvar('patroni::consul_cacert') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_cert') != nil -%>
  cert: <%= scope.lookupvar('patroni::consul_cert') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_key') != nil -%>
  key: <%= scope.lookupvar('patroni::consul_key') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_dc') != nil -%>
  dc: <%= scope.lookupvar('patroni::consul_dc') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_consistency') != nil -%>
  consistency: <%= scope.lookupvar('patroni::consul_consistency') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_checks') != nil -%>
  checks: <%= scope.lookupvar('patroni::consul_checks') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_register_service') != nil -%>
  register_service: <%= scope.lookupvar('patroni::consul_register_service') %>
<% end -%>
<% if scope.lookupvar('patroni::consul_service_check_interval') != nil -%>
  service_check_interval: <%= scope.lookupvar('patroni::consul_service_check_interval') %>
<% end -%>
<% end -%>
